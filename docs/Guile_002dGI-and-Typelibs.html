<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright (C) 2018, 2019, 2020 Michael L. Gran

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is included in the section entitled "GNU
Free Documentation License". -->
<!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Guile-GI and Typelibs (Guile GI)</title>

<meta name="description" content="Guile-GI and Typelibs (Guile GI)">
<meta name="keywords" content="Guile-GI and Typelibs (Guile GI)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="The-Index.html#The-Index" rel="index" title="The Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Getting-Started.html#Getting-Started" rel="up" title="Getting Started">
<link href="Sample-Applications.html#Sample-Applications" rel="next" title="Sample Applications">
<link href="Installation.html#Installation" rel="prev" title="Installation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="document-1.0.1.css">


</head>

<body lang="en">
<span id="Guile_002dGI-and-Typelibs"></span><div class="header">
<p>
Next: <a href="Sample-Applications.html#Sample-Applications" accesskey="n" rel="next">Sample Applications</a>, Previous: <a href="Installation.html#Installation" accesskey="p" rel="prev">Installation</a>, Up: <a href="Getting-Started.html#Getting-Started" accesskey="u" rel="up">Getting Started</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="The-Index.html#The-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Guile_002dGI-and-Typelibs-1"></span><h3 class="section">1.2 Guile-GI and Typelibs</h3>

<p>To understand how Guile-GI works, one needs to distinguish between
itself and the bindings it creates.
</p>
<ul>
<li> Guile-GI itself is a library that allows you to parse <code>typelib</code>
files, which describe code modules.  It has a handful of procedures for
inspecting <code>typelib</code> files as well as some helper procedures for
dynamically creating procedures and types.
</li><li> When Guile-GI is used, it creates procedures, variables, and types
according to the instructions in the <code>typelib</code> files.  These are
created <em>at runtime</em> as Guile loads them from the <code>typelib</code>
file.
</li></ul>

<p>In order to make use of the latter, you must load a typelib through
Guile-GI in one form or another.  The easiest and recommended way of
doing so is <code>use-typelibs</code>, as shown below.
</p>
<div class="example">
<pre class="example">(use-modules (gi))
(use-typelibs (&quot;GLib&quot; &quot;2.0&quot;) (&quot;Gtk&quot; &quot;3.0&quot;))
</pre></div>

<p><code>use-typelibs</code> works quite similar to <code>use-modules</code> and is in
fact implemented in terms of it. The only difference in syntax is, that
instead of a list of symbols describing a module, you have a list of
exactly two strings, the first being the name of the typelib and the
second being the version.
</p>
<p>Semantically, however, the difference to <code>use-modules</code> is bigger.
Internally, Guile-GI creates modules for the typelibs as needed &ndash; in
this example these modules would be <code>(%gi GLib-2.0)</code> and <code>(%gi
Gtk-3.0)</code> &ndash; and loads the entire typelib into them. This approach has
two major drawbacks.
</p><ol>
<li> Guile-GI has to load the entire typelib. For large typelibs, such as
GTK, this takes a lot of time.  Instead, you may want to only load
parts, e.g. just GtkApplication and GtkWindow to significantly speed up
loading.  <code>(gi repository)</code> has primitives to facilitate exactly
that. See <a href="Typelib-Introspection.html#Typelib-Introspection">Typelib Introspection</a>.

</li><li> Even though Guile-GI internally uses modules, these modules are not
available to the user in any meaningful way.  Even another
<code>use-modules</code> on them actually leads to undefined behaviour.  It
may load the module if it has already been defined somewhere else, but
it might also throw an error, claiming that no code for the module could
be found.  This is to be expected, given that the modules are not backed
by actual files.

<p>If you need to use <code>use-modules</code> (e.g. as a part of a
<code>define-module</code>), you need to write the module yourself.  As a
convenience, <code>(gi repository)</code> defines <code>typelib-&gt;module</code>,
which loads a typelib into a module and also adds all loaded
functionality to its public interface.  Use it as in the following
example.
</p><div class="example">
<pre class="example">(define-module (gi gtk-3)
  #:use-module (gi)
  #:use-module (gi repository))

(typelib-&gt;module (current-module) &quot;Gtk&quot; &quot;3.0&quot;)

;; additional code you might want to add and export
</pre></div>
</li></ol>

<p>Loading typelibs alone might be all you need if you have perfect
knowledge of all the libraries you are going to use and an intuitive
understanding of how they are mapped to Scheme procedures.  Chances are,
however, that you do not.  In this case, it might be useful to generate
some documentation. See <a href="Typelib-Documentation.html#Typelib-Documentation">Typelib Documentation</a>.
</p>
<p>Upon installation of Guile-GI, we install a script called
<code>gi-gtkdoc</code>, that can be invoked through <code>guild</code>.  You may
also want to create a <samp>guile-procedures.txt</samp> file for use in the
REPL.  We currently have no script for that, but one can easily be
written.  The following for example exports all the documentation for
GObject-2.0.
</p>
<div class="example">
<pre class="example">#!/path/to/guile
!#
(use-modules (gi documentation))

(let ((%typelib (typelib &quot;GObject&quot; &quot;2.0&quot;))
      (%gir (false-if-exception (gir &quot;GObject&quot; &quot;2.0&quot;)))
      (%doc '()))
  (set! %doc (parse %typelib %doc))
  (close %typelib)
  (when %gir
    (set! %doc (parse %gir %doc))
    (close %gir))
  (-&gt;guile-procedures.txt %doc))
</pre></div>

<p>Use shell pipes to redirect the output into a file, preferably one
called &ldquo;guile-procedures.txt&rdquo;.  Guile will search for documentation in
such files in a few locations, including the current working directory.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Sample-Applications.html#Sample-Applications" accesskey="n" rel="next">Sample Applications</a>, Previous: <a href="Installation.html#Installation" accesskey="p" rel="prev">Installation</a>, Up: <a href="Getting-Started.html#Getting-Started" accesskey="u" rel="up">Getting Started</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="The-Index.html#The-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
